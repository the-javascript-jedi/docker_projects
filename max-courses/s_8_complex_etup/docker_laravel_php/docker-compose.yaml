version: "3.8"

services:
  server:
    image: 'nginx:stable-alpine'
    ports:
      - "8000:80"
    # copy the nginx file from the path provided(./nginx/nginx.conf):to the path inside docker container(/etc/nginx/nginx.conf:ro)
    # ro - read only so container can never change configuration
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
  php:
    build:
      context: ./dockerfiles
      dockerfile: php.dockerfile
    volumes:
    # bind mount point at the src folder in local machine and we'll then mount this to the var/www/html path inside of the container.
    # delegated is a optimization improvement
      - ./src:/var/www/html:delegated
    ports:
    # docker image for php exposes 9000, we expect 3000
    # we have to map 3000 to 9000.
    # host machine first:our container internal port.
      - '3000:9000'  
  # mysql:
  mysql:
    image: mysql:5.7
    # to connect mysql we need to specify environment variables
    env_file:
      - ./env/mysql.env
  # composer:
    composer:
      build:
        context: ./dockerfiles
        dockerfile: composer.dockerfile
      # expose the source folder specified in composer.dockerfile
      volumes:
        - ./src:/var/www/html
  # artisan:
  # npm:    